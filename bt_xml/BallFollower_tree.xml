<!-- Behaviour Tree that sequentially navigates locations naively -->
<root main_tree_to_execute = "MainTree">
    <BehaviorTree ID="MainTree">
        <PipelineSequence name="MainSequence">
            <Sequence name="root_sequence">
                <InitiallizeActuators name = "initiallize_actutatos"
                    Op_RollerStatus="{RollerStatus}"
                    Op_RollerSpeed="{RollerSpeed}"
                    Op_ConveyerStatus="{ConveyerStatus}"
                    Op_ConveyerSpeed="{ConveyerSpeed}"
                    Op_PneumaticStatus="{PneumaticStatus}" />

                <PneumaticOff name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
                <TurnOffRoller name = "Stop_roller" Op_RollerStatus="{RollerStatus}"/> 
                <TurnOffConveyer name = "Stop_conveyer" Op_ConveyerStatus="{ConveyerStatus}"/> 
                <TurnOnConveyer name = "Keep_conveyer_running" 
                    Op_ConveyerStatus="{ConveyerStatus}"
                    Op_ConveyerSpeed="{ConveyerSpeed}" 
                    Ip_ConveyerSpeed="50"/>
                <TurnOnRoller name = "Keep_Roller_running" 
                    Op_RollerStatus="{RollerStatus}"
                    Op_RollerSpeed="{RollerSpeed}"
                    Ip_RollerSpeed="50"/>
                <PneumaticOn name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
                <Sequence name="navigate_to_ball_pos">
                    <PneumaticOff name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
                    <PneumaticOn name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
                    <!-- <RecoveryNode number_of_retries="10" name="RecoveryNode">
                        <isBallInside name="isBallInside" OP_IsBallInside="{IsBallInside}"/>                  
                        <RoundRobin name="spin_sequence">
                            <spinActionClient name="spin1" In_angle="0.78"/>
                            <waitActionClient name="wait1" In_sec="0.5" In_nanosec="1"/>
                            <spinActionClient name="spin2" In_angle="-1.57"/>
                            <spinActionClient name="spin3" In_angle="0.78"/>
                        </RoundRobin>
                    </RecoveryNode> -->
                    <GetBallPose name="GetBallPose_node" op_pose="{pose}"/>
                    <!-- <GoToBallPose name="GoToBallPose_node" in_pose="{pose}"/> -->
                </Sequence> 
                <SubTree ID="Ball_Intake"    />
                <PneumaticOff name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
            </Sequence> 
            <!-- <PacketPublisher name="packet_publisher" 
                Ip_RollerStatus="{RollerStatus}"
                Ip_RollerSpeed="{RollerSpeed}"
                Ip_ConveyerStatus="{ConveyerStatus}"
                Ip_ConveyerSpeed="{ConveyerSpeed}"
                Ip_PneumaticStatus="{PneumaticStatus}"/> -->
        </PipelineSequence>
    </BehaviorTree>



    <BehaviorTree ID="Ball_Intake">
        <Sequence name="Ball_Intake_Sequence">
            <SubTree ID="Start_mechanisms"/>
            <SubTree ID="Retrieve _balls"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="Start_mechanisms">
        <Sequence name = "Starting sequence">
            <PneumaticOn name="Lower_pneumatic"/>
            <TurnOnRoller name = "Start_intake_roller" 
                    Op_RollerStatus="{RollerStatus}"
                    Op_RollerSpeed="{RollerSpeed}"
                    Ip_RollerSpeed="50"/>
            <TurnOnConveyer name = "Keep_conveyer_running" 
                    Op_ConveyerStatus="{ConveyerStatus}"
                    Op_ConveyerSpeed="{ConveyerSpeed}" 
                    Ip_ConveyerSpeed="50"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="Retrieve _balls">
        <WhileDoElse name = "Ball_intake_">
            <isBallInside name="isBallInside"/>
            <Sequence name = "Remove_Extra_balls">
                <TurnOffRoller name = "Stop_roller" Op_RollerStatus="{RollerStatus}"/> 
                <WhileDoElse name = "Remove_Extra_balls">
                    <isOnlyBall name = "is_required_ball_only"/>
                    <TurnOffConveyer name = "Stop_conveyer" Op_ConveyerStatus="{ConveyerStatus}"/> 
                    <TurnOnConveyer name = "Keep_conveyer_running" 
                        Op_ConveyerStatus="{ConveyerStatus}"
                        Op_ConveyerSpeed="{ConveyerSpeed}" 
                        Ip_ConveyerSpeed="50"/>
                </WhileDoElse>
            </Sequence>
            <PneumaticOff name="Lower_pneumatic" Op_PneumaticStatus="{PneumaticStatus}"/>
             <!-- <MoveForwar name ="Forward_small_Dist"/>  -->
        </WhileDoElse>
    </BehaviorTree> 
</root>



